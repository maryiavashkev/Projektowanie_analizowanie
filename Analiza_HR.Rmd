---
title: "Analiza danych_HR"
author: "Aleksandra Łada, Marcin Skowronek, Maryia Vashkevich"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    highlight: kate
    self_contained: true
    number_sections: true
    code_folding: show
    Fig_width: 8
    Fig_height: 5
    Fig_caption: true
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
dane <- read.csv("HR.csv")
library(tidyverse)
library(naniar)
library(finalfit)
library(validate)
```

# 1. Wprowadzenie

Celem raportu jest analiza firmowych danych HR za dany okres. Raport zawiera przegląd najważniejszych wskaźników, wizualizację danych oraz wyciągnięte wnioski. Zbiór danych zawiera 1470 wierszy oraz 35 kolumn.

## Pytania badawcze

1. Czy nadgodziny i niskie zadowolenie ze środowiska zwiększają ryzyko odejścia pracownika?
2. Czy pracownicy z niższym miesięcznym wynagrodzeniem lub rzadkimi awansami odchodzą częściej?
3. Jaka jest charakterystyka (wiek, staż pracy) pracownika, który najczęściej decyduje się na odejście?
4. Które działy oraz stanowiska są najbardziej narażone na odejścia pracowników?

# Opis danych

Analizowany zbiór danych zawiera informacje dotyczące pracowników firmy.

Zmienne w zbiorze danych można podzielić na następujące kategorie:

Zmienna Objaśniana:
Attrition: Zmienna kategoryczna wskazująca na to, czy pracownik odszedł z firmy.

Zmienne Demograficzne i Osobiste:
Age: Wiek pracownika (Lata)
Gender: Płeć pracownika.
MaritalStatus: Stan cywilny (Single, Married, Divorced). 
Education: Poziom wykształcenia (1-5). 
EducationField: Dziedzina wykształcenia (np. Life Sciences, Medical). 
DistanceFromHome: Odległość od domu.

Zmienne Związane z Pracą oraz Rolą:
Department: Dział, w którym pracuje dana osoba (Sales, R&D, HR). 
JobRole: Konkretne stanowisko, które zajmuję dana osoba (np. Sales Executive, Laboratory Technician). 
JobLevel: Poziom stanowiska w strukturze firmy. 
BusinessTravel: Częstotliwość podróży służbowych (Rarely, Frequently, Non-Travel). 
OverTime: Czy pracownik pracuje w godzinach ponadwymiarowych (Yes/No).

Wynagrodzenie i Benefity:
MonthlyIncome: Miesięczne wynagrodzenie. 
DailyRate, HourlyRate, MonthlyRate: Stawki płacowe w różnych ujęciach czasowych. 
PercentSalaryHike: Procentowa podwyżka wynagrodzenia. 
StockOptionLevel: Poziom opcji na akcje pracownicze.

Satysfakcja i Oceny:
EnvironmentSatisfaction: Zadowolenie ze środowiska pracy. 
JobSatisfaction: Zadowolenie z wykonywanej pracy. 
WorkLifeBalance: Ocena równowagi między życiem zawodowym a prywatnym. RelationshipSatisfaction: Satysfakcja z relacji ze współpracownikami. 
PerformanceRating: Ocena wydajności pracownika.

Historia Zatrudnienia:
TotalWorkingYears: Całkowity staż pracy (lata). 
YearsAtCompany: Liczba lat przepracowanych w obecnej firmie. 
YearsInCurrentRole: Czas na obecnym stanowisku (lata).
YearsSinceLastPromotion: Czas, który upłynął od ostatniego awansu (lata). 
YearsWithCurrManager: Czas pracy z obecnym menedżerem (lata).


# 2. Porządkowanie i czyszczenie danych 

## 2.1 Braki danych

```{r}
procent <- prop_complete_var(dane)*100
```

W danych znajduje sie `r procent` 91.43 % kompletnych wartości.

```{r}
naniar::vis_miss(dane)
```

# Wizualizacje połączeń w brakach danych:

```{r message=FALSE, warning=FALSE}
naniar::gg_miss_upset(dane)
```


```{r message=FALSE, warning=FALSE}
library(finalfit)
finalfit::missing_pattern(dane)
```



```{r message=FALSE, warning=FALSE}
library(ggplot2)
ggplot(dane,aes(x=Age, y=MonthlyIncome)) + geom_miss_point() + 
  labs(tittle="Wzorce braków danych w HR", x="Age" , y="MonthlyIncome ()")
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
wykres<-finalfit::missing_pattern(dane)
wykres
```

# Inputacja metodą Hot-Deck

```{r}
library(VIM)
dane <- hotdeck(dane)
naniar::vis_miss(dane)
```

# Walidacja danych
```{r}
rules <- validator(
YearsAtCompany <= TotalWorkingYears
,YearsInCurrentRole <= YearsAtCompany
,YearsWithCurrManager <= YearsAtCompany
,YearsSinceLastPromotion <= YearsAtCompany
)
```

Reguły walidacji danych:
  1. Staż w firmie (YearsAtCompany) musi być mniejszy lub równy całkowitemu stażowi pracy (TotalWorkingYears). 
  2. Czas na obecnym stanowisku (YearsInCurrentRole) musi być mniejszy lub równy stażowi w firmie (YearsAtCompany).
  3. Czas pracy z obecnym menedżerem (YearsWithCurrManager) musi być mniejszy lub równy stażowi w firmie (YearsAtCompany).
  4. Lata od ostatniego awansu (YearsSinceLastPromotion) muszą być mniejsze lub równe stażowi w firmie (YearsAtCompany).

Pora zobaczyc czy zbior danych cos tam

```{r}
cf <- confront(dane, rules, key="EmployeeNumber")

barplot(cf)

```

# Wizualizacja danych

```{r warning=FALSE}
library(ggplot2)
library(scales)


ggplot(dane, aes(x = Department, y = MonthlyIncome, fill = Department)) +
  stat_summary(fun = "mean", geom = "bar", color = "black", width = 0.7) +
  stat_summary(fun = "mean", geom = "text", 
               aes(label = number(..y.., big.mark = " ", accuracy = 1)), 
               vjust = -0.5, size = 4) +
  scale_y_continuous(labels = comma_format(big.mark = " ", decimal.mark = ","),
                     expand = expansion(mult = c(0, 0.15))) + 
  scale_fill_brewer(palette = "Blues") +
  labs(title = "Średnie wynagrodzenie wg Działu",
       x = "Dział",
       y = "Średni miesięczny dochód") +
  theme_minimal() +
  theme(
    legend.position = "none",
    panel.grid.major.x = element_blank(), 
    plot.title = element_text(face = "bold", size = 16),
    axis.text.x = element_text(size = 11, color = "black")
  )
  
```

```{r warning=FALSE}
library(ggplot2)
library(scales)

dane$JobLevel <- as.factor(dane$JobLevel)

ggplot(dane, aes(x = Department, y = MonthlyIncome, fill = JobLevel)) +

  geom_boxplot(color = "black", alpha = 0.8, outlier.shape = 20) +

  scale_fill_brewer(palette = "Blues", name = "Poziom (JobLevel)") +

  scale_y_continuous(labels = comma_format(big.mark = " ", decimal.mark = ",")) +

  labs(title = "Zarobki w Działach wg Poziomu Stanowiska",
       x = "Dział (Department)",
       y = "Miesięczny dochód") +

  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    legend.position = "right" 
  )
```

